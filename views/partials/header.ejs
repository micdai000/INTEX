<!-- Mobile menu overlay - outside header for proper stacking -->
<div class="nav-overlay" id="navOverlay"></div>

<!-- Mobile navigation menu - outside header for proper stacking -->
<nav class="nav-menu" id="navMenu" role="navigation" aria-label="Main navigation">
  <% if (isAuthenticated) { %>
    <!-- Authenticated Navigation -->
    <a href="/dashboard" class="nav-link">Dashboard</a>

    <div class="dropdown">
      <button class="dropdown-toggle">
        View Data
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
        </svg>
      </button>
      <div class="dropdown-menu">
        <a href="/participants">Participants</a>
        <a href="/events">Events</a>
        <a href="/surveys">Surveys</a>
        <a href="/milestones">Milestones</a>
        <a href="/donations">Donations</a>
        <% if (isManager) { %>
          <a href="/users">Users</a>
        <% } %>
      </div>
    </div>

    <div class="nav-actions">
      <span class="user-name"><%= user.firstName || user.email %></span>
      <form action="/auth/logout" method="POST" style="display: inline;">
        <button type="submit" class="btn-pill btn-pill-secondary">Logout</button>
      </form>
    </div>
  <% } else { %>
    <!-- Public Navigation -->
    <a href="/about" class="nav-link">About</a>
    <a href="/workshops" class="nav-link">Programs</a>
    <a href="/contact" class="nav-link">Contact</a>
    <a href="https://givebutter.com/EllaRises" target="_blank" rel="noopener noreferrer" class="nav-link">Donate</a>
    <div class="nav-actions">
      <a href="/auth/login" class="btn-pill btn-pill-primary">Login</a>
    </div>
  <% } %>
</nav>

<header class="site-header floating-header" role="banner">
  <div class="floating-nav">
    <!-- Logo -->
    <a href="/" class="logo">
      <img src="/images/mainlogo.avif" alt="Ella Rises" class="logo-img">
      <span class="logo-name">Ella Rises</span>
    </a>

    <!-- Hamburger button for mobile -->
    <button class="hamburger" id="hamburger" aria-label="Toggle navigation menu" aria-expanded="false">
      <span></span>
      <span></span>
      <span></span>
    </button>

    <!-- Desktop Navigation (hidden on mobile, visible on desktop) -->
    <nav class="nav-menu-desktop" role="navigation" aria-label="Main navigation">
      <% if (isAuthenticated) { %>
        <!-- Authenticated Navigation -->
        <a href="/dashboard" class="nav-link">Dashboard</a>

        <div class="dropdown">
          <button class="dropdown-toggle">
            View Data
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </button>
          <div class="dropdown-menu">
            <a href="/participants">Participants</a>
            <a href="/events">Events</a>
            <a href="/surveys">Surveys</a>
            <a href="/milestones">Milestones</a>
            <a href="/donations">Donations</a>
            <% if (isManager) { %>
              <a href="/users">Users</a>
            <% } %>
          </div>
        </div>

        <div class="nav-actions">
          <span class="user-name"><%= user.firstName || user.email %></span>
          <form action="/auth/logout" method="POST" style="display: inline;">
            <button type="submit" class="btn-pill btn-pill-secondary">Logout</button>
          </form>
        </div>
      <% } else { %>
        <!-- Public Navigation -->
        <a href="/about" class="nav-link">About</a>
        <a href="/workshops" class="nav-link">Programs</a>
        <a href="/contact" class="nav-link">Contact</a>
        <a href="https://givebutter.com/EllaRises" target="_blank" rel="noopener noreferrer" class="nav-link">Donate</a>
        <div class="nav-actions">
          <a href="/auth/login" class="btn-pill btn-pill-primary">Login</a>
        </div>
      <% } %>
    </nav>
  </div>
</header>

<script>
// Mobile navigation toggle
document.addEventListener('DOMContentLoaded', function() {
  const hamburger = document.getElementById('hamburger');
  const navMenu = document.getElementById('navMenu');
  const navOverlay = document.getElementById('navOverlay');
  const dropdowns = document.querySelectorAll('.dropdown');

  // Toggle mobile menu
  hamburger.addEventListener('click', function() {
    hamburger.classList.toggle('active');
    navMenu.classList.toggle('active');
    navOverlay.classList.toggle('active');
    document.body.style.overflow = navMenu.classList.contains('active') ? 'hidden' : '';
    hamburger.setAttribute('aria-expanded', navMenu.classList.contains('active'));
  });

  // Close menu when clicking overlay
  navOverlay.addEventListener('click', function() {
    hamburger.classList.remove('active');
    navMenu.classList.remove('active');
    navOverlay.classList.remove('active');
    document.body.style.overflow = '';
    hamburger.setAttribute('aria-expanded', 'false');
  });

  // Close menu when clicking a link (mobile)
  navMenu.querySelectorAll('a').forEach(function(link) {
    link.addEventListener('click', function() {
      if (window.innerWidth <= 768) {
        hamburger.classList.remove('active');
        navMenu.classList.remove('active');
        navOverlay.classList.remove('active');
        document.body.style.overflow = '';
      }
    });
  });

  // Mobile dropdown toggle
  dropdowns.forEach(function(dropdown) {
    const toggle = dropdown.querySelector('.dropdown-toggle');
    toggle.addEventListener('click', function(e) {
      if (window.innerWidth <= 768) {
        e.preventDefault();
        dropdown.classList.toggle('active');
      }
    });
  });
});
</script>
