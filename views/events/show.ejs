<!-- Event Details -->
<section class="py-8">
  <div class="container px-4 md:px-6">
    <div class="mb-6">
      <a href="/events" class="text-sm text-ella-coral hover:underline">&larr; Back to Events</a>
    </div>

    <div class="card mb-6">
      <div class="card-header flex justify-between items-center">
        <h1 class="text-2xl font-serif"><%= event.event_name %></h1>
        <% if (isManager) { %>
          <div class="actions">
            <a href="/events/<%= event.event_id %>/edit" class="btn-secondary btn-sm">Edit</a>
            <form method="POST" action="/events/<%= event.event_id %>/delete" class="inline" onsubmit="return confirm('Delete this event and all its occurrences?')">
              <button type="submit" class="btn-danger btn-sm">Delete</button>
            </form>
          </div>
        <% } %>
      </div>
      <div class="card-body">
        <div class="grid md:grid-cols-2 gap-4 mb-4">
          <div>
            <p class="text-sm text-gray-500">Event Type</p>
            <p class="font-medium"><%= event.event_type || '-' %></p>
          </div>
          <div>
            <p class="text-sm text-gray-500">Recurrence</p>
            <p class="font-medium"><%= event.event_recurrence_pattern || 'One-time' %></p>
          </div>
          <div>
            <p class="text-sm text-gray-500">Default Capacity</p>
            <p class="font-medium"><%= event.event_default_capacity || 'No limit' %></p>
          </div>
        </div>
        <% if (event.event_description) { %>
          <div>
            <p class="text-sm text-gray-500 mb-2">Description</p>
            <p><%= event.event_description %></p>
          </div>
        <% } %>
      </div>
    </div>

    <!-- Event Occurrences -->
    <div class="card">
      <div class="card-header flex justify-between items-center">
        <h2 class="text-lg font-serif">Event Occurrences</h2>
        <% if (isManager) { %>
          <button type="button" class="btn-primary btn-sm" onclick="document.getElementById('addOccurrenceForm').classList.toggle('hidden')">
            + Add Occurrence
          </button>
        <% } %>
      </div>

      <% if (isManager) { %>
      <!-- Add Occurrence Form -->
      <div id="addOccurrenceForm" class="hidden card-body border-b">
        <form method="POST" action="/events/<%= event.event_id %>/occurrences">
          <div class="grid md:grid-cols-2 gap-4 mb-4">
            <div class="form-group">
              <label class="form-label" for="event_datetime_start">Start Date & Time *</label>
              <input type="datetime-local" id="event_datetime_start" name="event_datetime_start" class="form-input" required>
            </div>
            <div class="form-group">
              <label class="form-label" for="event_datetime_end">End Date & Time</label>
              <input type="datetime-local" id="event_datetime_end" name="event_datetime_end" class="form-input">
            </div>
            <div class="form-group">
              <label class="form-label" for="event_location">Location *</label>
              <input type="text" id="event_location" name="event_location" class="form-input" required placeholder="e.g., BYU Talmage Building">
            </div>
            <div class="form-group">
              <label class="form-label" for="event_capacity">Capacity</label>
              <input type="number" id="event_capacity" name="event_capacity" class="form-input" value="<%= event.event_default_capacity || '' %>" placeholder="Leave blank for no limit">
            </div>
            <div class="form-group">
              <label class="form-label" for="event_registration_deadline">Registration Deadline</label>
              <input type="datetime-local" id="event_registration_deadline" name="event_registration_deadline" class="form-input">
            </div>
          </div>
          <div class="flex gap-2">
            <button type="submit" class="btn-primary">Add Occurrence</button>
            <button type="button" class="btn-secondary" onclick="document.getElementById('addOccurrenceForm').classList.add('hidden')">Cancel</button>
          </div>
        </form>
      </div>
      <% } %>

      <div class="card-body p-0">
        <% if (occurrences.length > 0) { %>
          <table>
            <thead>
              <tr>
                <th>Date & Time</th>
                <th>Location</th>
                <th>Capacity</th>
                <th>Registrations</th>
                <% if (isManager) { %><th>Actions</th><% } %>
              </tr>
            </thead>
            <tbody>
              <% occurrences.forEach(o => { %>
                <tr>
                  <td>
                    <%= o.event_datetime_start ? new Date(o.event_datetime_start).toLocaleString() : '-' %>
                    <% if (o.event_datetime_end) { %>
                      <br><span class="text-sm text-gray-500">to <%= new Date(o.event_datetime_end).toLocaleTimeString() %></span>
                    <% } %>
                  </td>
                  <td><%= o.event_location || '-' %></td>
                  <td><%= o.event_capacity || 'No limit' %></td>
                  <td><%= o.registration_count %></td>
                  <% if (isManager) { %>
                  <td>
                    <div class="flex gap-2">
                      <a href="/events/<%= event.event_id %>/occurrences/<%= o.event_occurrence_id %>/edit" class="btn-secondary btn-sm">Edit</a>
                      <form method="POST" action="/events/<%= event.event_id %>/occurrences/<%= o.event_occurrence_id %>/delete" class="inline" onsubmit="return confirm('Delete this occurrence? This will also delete all registrations for this occurrence.')">
                        <button type="submit" class="btn-danger btn-sm">Delete</button>
                      </form>
                    </div>
                  </td>
                  <% } %>
                </tr>
              <% }); %>
            </tbody>
          </table>
        <% } else { %>
          <div class="empty-state">
            <p>No occurrences scheduled.</p>
          </div>
        <% } %>
      </div>
    </div>
  </div>
</section>
